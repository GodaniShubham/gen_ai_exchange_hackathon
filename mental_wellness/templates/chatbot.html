<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chatbot | Saharathi AI</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

</head>
<body>

<!-- Offline Banner -->
<div id="offlineBanner" class="hidden fixed top-0 left-0 w-full bg-red-600 text-white py-4 flex items-center justify-center gap-3 shadow-lg z-50 rounded-b-3xl">
  <i class="fas fa-wifi-slash fa-lg"></i>
  <span class="font-medium text-base">ğŸ”´ You are offline. Some features may not work.</span>
</div>

<div class="h-screen flex bg-gradient-to-br from-gray-900 to-black text-white font-[system-ui,-apple-system,BlinkMacSystemFont] antialiased overflow-hidden">

  <!-- ğŸ“œ Sidebar / History -->
  <div class="h-full w-64 bg-black/90 border-r border-gray-800 flex flex-col transform transition-transform duration-300 ease-in-out -translate-x-full md:translate-x-0 fixed md:static z-20" id="sidebar">

    <div class="p-6 flex items-center justify-between border-b border-gray-800/50">
      <h2 class="text-lg font-semibold text-gray-300">Chats</h2>
      <button onclick="newChat()" 
              class="px-4 py-2 text-sm font-medium rounded-full bg-gradient-to-r from-green-500 to-teal-600 hover:from-teal-600 hover:to-green-500 transition shadow-md">
        + New
      </button>
    </div>

    <!-- Sidebar Buttons -->
    <div class="flex flex-col p-4 space-y-3 border-b border-gray-800/50">
      <a href="{% url 'selfcare' %}" class="flex items-center gap-3 px-4 py-3 rounded-2xl bg-gray-800/50 hover:bg-green-600/20 transition shadow-sm text-sm">
        <i class="fas fa-heart text-green-400"></i> Self Care Guides
      </a>
      <a href="{% url 'analysis' %}" class="flex items-center gap-3 px-4 py-3 rounded-2xl bg-gray-800/50 hover:bg-green-600/20 transition shadow-sm text-sm">
        <i class="fas fa-chart-line text-green-400"></i> Mood Analytics
      </a>
      <a href="{% url 'journals:journal_page' %}" class="flex items-center gap-3 px-4 py-3 rounded-2xl bg-gray-800/50 hover:bg-green-600/20 transition shadow-sm text-sm">
        <i class="fas fa-book text-green-400"></i> Journal
      </a>
      <a href="{% url 'settings_privacy' %}" class="flex items-center gap-3 px-4 py-3 rounded-2xl bg-gray-800/50 hover:bg-green-600/20 transition shadow-sm text-sm">
        <i class="fas fa-cog text-green-400"></i> Settings & Privacy
      </a>
      <button onclick="downloadChat()" class="flex items-center gap-3 px-4 py-3 rounded-2xl bg-gray-800/50 hover:bg-green-600/20 transition shadow-sm text-sm">
        <i class="fas fa-download text-green-400"></i> Export Chat
      </button>
    </div>

    <!-- Chat History -->
    <div id="chat_history" class="flex-1 overflow-y-auto p-4 space-y-3 text-sm scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-900">
      <div class="text-gray-500 italic text-center">No chats yet...</div>
    </div>

    <div class="p-4 border-t border-gray-800/50 text-xs text-gray-400 flex justify-center">
      <button onclick="clearHistory()" class="hover:text-red-400 transition">ğŸ—‘ Clear all</button>
    </div>
  </div>

  <!-- Sidebar Toggle for Mobile -->
  <button id="sidebarToggle" class="absolute top-4 left-4 z-20 md:hidden p-2 rounded-full bg-gray-800/50 hover:bg-green-600/30 transition shadow-sm">
    <i class="fas fa-bars text-xl text-gray-300"></i>
  </button>

  <!-- ğŸ’¬ Main Chat Area -->
  <div class="flex-1 flex flex-col relative">
    
    <!-- Header -->
<div class="p-6 border-b border-gray-800/50 bg-black/70 backdrop-blur-xl flex justify-between items-center shadow-sm">

  <!-- ğŸ”™ Back Button -->
  <a href="{% url 'index' %}" 
     class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-800/50 hover:bg-green-600/30 transition shadow-sm text-sm text-gray-300">
    <i class="fas fa-arrow-left"></i> Back
  </a>

  <h1 class="text-2xl font-bold bg-gradient-to-r from-green-400 to-teal-500 bg-clip-text text-transparent">
    ğŸ’¬ Chat with Saharathi AI
  </h1>



      <!-- ğŸ™ï¸ Voice Controls -->
      <div class="flex items-center gap-3 text-sm">
        <span class="text-gray-300">Voice:</span>
        <button onclick="setVoice('male')" id="maleBtn" class="px-3 py-1.5 rounded-full bg-gray-800/50 hover:bg-green-600/30 transition shadow-sm">ğŸ‘¨ Male</button>
        <button onclick="setVoice('female')" id="femaleBtn" class="px-3 py-1.5 rounded-full bg-gray-800/50 hover:bg-green-600/30 transition shadow-sm">ğŸ‘© Female</button>
        <button onclick="speakBotReply()" class="px-4 py-1.5 rounded-full bg-green-600 hover:bg-green-700 transition shadow-md">ğŸ”Š Speak</button>
      </div>
    </div>

    <!-- ğŸŒ± Daily Tip Widget -->
    <div id="daily_tip" class="p-4 text-sm bg-gradient-to-r from-green-500/80 to-teal-600/80 text-white text-center rounded-b-3xl shadow-md animate-slideDown">
      ğŸŒ± Daily Tip: Stay hydrated and take deep breaths!
    </div>

    <!-- ğŸŒˆ Mood Selector -->
    <div class="flex flex-wrap gap-4 p-6 bg-black/50 border-b border-gray-800/50 text-sm text-gray-300 items-center shadow-inner">
      <span class="font-medium text-base">How are you feeling today?</span>
      <div class="flex gap-3" id="moodButtons">
        <button onclick="setMood('ğŸ˜Š Happy')" id="mood_happy" 
          class="px-4 py-2 rounded-full bg-gray-800/50 hover:scale-105 hover:bg-green-600/30 transition-all shadow-md text-lg">ğŸ˜Š Happy</button>
        <button onclick="setMood('ğŸ˜Ÿ Stressed')" id="mood_stressed" 
          class="px-4 py-2 rounded-full bg-gray-800/50 hover:scale-105 hover:bg-green-600/30 transition-all shadow-md text-lg">ğŸ˜Ÿ Stressed</button>
        <button onclick="setMood('ğŸ˜” Sad')" id="mood_sad" 
          class="px-4 py-2 rounded-full bg-gray-800/50 hover:scale-105 hover:bg-green-600/30 transition-all shadow-md text-lg">ğŸ˜” Sad</button>
        <button onclick="setMood('ğŸ˜ Neutral')" id="mood_neutral" 
          class="px-4 py-2 rounded-full bg-gray-800/50 hover:scale-105 hover:bg-green-600/30 transition-all shadow-md text-lg">ğŸ˜ Neutral</button>
      </div>
      <span id="selectedMood" class="ml-4 text-green-400 italic text-base"></span>
    </div>

    <!-- Chat Window -->
    <div id="chat_area" 
         class="flex-1 overflow-y-auto p-8 space-y-6 scroll-smooth bg-gradient-to-b from-gray-900/80 to-black/80 scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-transparent">
      <div class="text-center text-gray-400 italic animate-fadeIn">ğŸ‘‹ Start a conversation...</div>
    </div>

    <!-- ğŸ†• Smart Suggestions -->
    <div id="suggestions" class="flex flex-wrap gap-3 px-8 pb-3"></div>

    <!-- Typing Indicator -->
    <div id="typing" class="hidden px-8 pb-3 text-gray-300 italic flex gap-3 items-center">
      <span class="dot w-3 h-3 bg-green-400 rounded-full animate-bounce"></span>
      <span class="dot w-3 h-3 bg-green-400 rounded-full animate-bounce delay-200"></span>
      <span class="dot w-3 h-3 bg-green-400 rounded-full animate-bounce delay-400"></span>
      <span>Typing...</span>
    </div>

    <!-- Error Message -->
    <div id="errorMessage" class="hidden px-8 pb-3 text-red-400 italic flex gap-3 items-center">
      <i class="fas fa-exclamation-triangle"></i>
      <span>Error occurred. Please try again.</span>
    </div>

    <!-- Input Box -->
    <div class="p-6 border-t border-gray-800/50 bg-black/70 backdrop-blur-xl space-y-4 shadow-lg">
      <!-- Quick Suggestions -->
      <div class="flex flex-wrap gap-3">
        <button onclick="sendQuick('I feel stressed')" class="px-4 py-2 bg-gray-800/50 hover:bg-green-600/30 rounded-full text-sm shadow-sm transition">I feel stressed</button>
        <button onclick="sendQuick('Give me meditation tips')" class="px-4 py-2 bg-gray-800/50 hover:bg-green-600/30 rounded-full text-sm shadow-sm transition">Meditation Tips</button>
        <button onclick="sendQuick('Help me with sleep')" class="px-4 py-2 bg-gray-800/50 hover:bg-green-600/30 rounded-full text-sm shadow-sm transition">Sleep Help</button>
      </div>

      <div class="flex items-center gap-4 bg-gray-900/50 px-5 py-3 rounded-3xl border border-gray-700/50 shadow-md">
        <!-- File -->
        <label for="file_input" class="cursor-pointer text-gray-300 hover:text-green-400 transition" aria-label="Attach file">
          <i class="fas fa-paperclip text-xl"></i>
        </label>
        <input type="file" id="file_input" class="hidden" />

        <!-- Mic ğŸ¤ -->
        <button onclick="startVoice()" class="text-gray-300 hover:text-green-400 transition" aria-label="Voice input">
          <i class="fas fa-microphone text-xl"></i>
        </button>

        <!-- Text -->
        <input type="text" id="user_input"
               class="flex-grow bg-transparent outline-none px-3 text-white placeholder-gray-400 text-base"
               placeholder="Type your message..." aria-label="Message input" />

        <!-- Send -->
        <button onclick="sendMessage()" 
                class="p-3 rounded-full bg-gradient-to-r from-green-500 to-teal-600 hover:from-teal-600 hover:to-green-500 transition shadow-md" aria-label="Send message">
          <i class="fas fa-paper-plane text-lg"></i>
        </button>
      </div>
    </div>
  </div>
</div>
</body>
<!-- JS -->
<script>
  // ğŸŒ Offline / Online Detection
  window.addEventListener("online", () => {
    const banner = document.getElementById("offlineBanner");
    banner.classList.add("hidden");
    renderMessages([{sender:"bot", text:"ğŸŸ¢ You are back online!"}], true);
  });

  window.addEventListener("offline", () => {
    const banner = document.getElementById("offlineBanner");
    banner.classList.remove("hidden");
    banner.classList.add("show");
    renderMessages([{sender:"bot", text:"ğŸ”´ You went offline. Donâ€™t worry, Iâ€™ll save your thoughts until we reconnect."}], true);
  });

  let currentChatId = null;
  let userMood = "ğŸ˜ Neutral";  
  let synth = window.speechSynthesis;
  let lastBotReply = "";
  let selectedVoice = "male"; // default
  let voices = [];
  let isSpeaking = false;

  // ğŸ”Š Load Voices
  function loadVoices(){
    voices = synth.getVoices();
  }
  window.speechSynthesis.onvoiceschanged = loadVoices;

  // ğŸŸ¢ First-time Welcome Message
  document.addEventListener("DOMContentLoaded", function() {
    loadVoices(); // Load voices early
    if (!localStorage.getItem("visitedBefore")) {
      setTimeout(() => {
        renderMessages([
          {
            sender: "bot",
            text: "ğŸ‘‹ Welcome! Iâ€™m Saharathi AI ğŸŒ± I can help you with stress, sleep, meditation, mood, and mental wellness. How are you feeling today?"
          }
        ], true);
      }, 800);

      localStorage.setItem("visitedBefore", "yes");
    }
    updateDailyTip(); // Initialize daily tip
  });

  // ğŸŸ¢ Download Chat History
  function downloadChat() {
    const chatText = Array.from(document.querySelectorAll("#chat_area > div")).map(div => {
      const bubble = div.querySelector('.bot-bubble, .user-bubble');
      const sender = bubble.classList.contains('bot-bubble') ? 'Bot' : 'User';
      return `${sender}: ${bubble.innerText}`;
    }).join('\n\n');
    if (!chatText.trim()) {
      showError("âš ï¸ No chat available to export!");
      return;
    }

    const blob = new Blob([chatText], { type: "text/plain" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "chat_history.txt";
    link.click();
  }

  // ğŸ’¡ Smart Suggestions
  function showSuggestions(userMessage){
    const suggestionBox = document.getElementById("suggestions");
    suggestionBox.innerHTML = ""; // clear old

    let suggestions = [];
    if (userMessage.toLowerCase().includes("stress")) {
      suggestions = ["Any quick stress relief tips?", "Guide me for breathing exercise"];
    } else if (userMessage.toLowerCase().includes("sleep")) {
      suggestions = ["How to sleep faster?", "Tell me a bedtime meditation"];
    } else if (userMessage.toLowerCase().includes("sad") || userMessage.toLowerCase().includes("depress")) {
      suggestions = ["Motivate me ğŸ™", "Any self-care tips?"];
    } else {
      suggestions = ["Give me a tip", "Suggest meditation", "Show mood analytics"];
    }

    suggestions.forEach(sug => {
      const btn = document.createElement("button");
      btn.className = "px-3 py-1 m-1 rounded-lg bg-gray-700 hover:bg-green-600 transition";
      btn.innerText = sug;
      btn.onclick = ()=> sendQuick(sug);
      suggestionBox.appendChild(btn);
    });
  }

  // âœ… Mood Selector
  function setMood(mood){
    userMood = mood;
    document.querySelectorAll("#moodButtons button").forEach(btn => {
      btn.classList.remove("bg-green-600/30");
      btn.classList.add("bg-gray-800/50");
    });
    if (mood.includes("Happy")) document.getElementById("mood_happy").classList.add("bg-green-600/30");
    if (mood.includes("Stressed")) document.getElementById("mood_stressed").classList.add("bg-green-600/30");
    if (mood.includes("Sad")) document.getElementById("mood_sad").classList.add("bg-green-600/30");
    if (mood.includes("Neutral")) document.getElementById("mood_neutral").classList.add("bg-green-600/30");
    document.getElementById("selectedMood").innerText = `Selected: ${mood}`;
  }

  // âœ… Daily Tips
  const tips = [
    "ğŸŒ± Drink at least 8 glasses of water.",
    "ğŸ§˜ Practice meditation for 5 mins daily.",
    "ğŸ˜´ Get 7-8 hours of quality sleep.",
    "ğŸš¶ Take a 15-minute walk outdoors."
  ];
  let tipIndex = 0;
  function updateDailyTip(){
    document.getElementById("daily_tip").innerText = tips[tipIndex];
    tipIndex = (tipIndex + 1) % tips.length;
  }
  setInterval(updateDailyTip, 10000); // Change every 10 seconds

  // âœ… CSRF helper
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";"); 
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + "=")) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  const csrftoken = getCookie("csrftoken");

  // ğŸ†• Create new chat
  function newChat(){
    currentChatId = null;
    document.getElementById("chat_area").innerHTML = `<div class="text-center text-gray-400 italic animate-fadeIn">ğŸ†• New conversation...</div>`;
    hideSidebarOnMobile();
  }

  // ğŸ“¥ Load messages
  async function loadChat(id, title){
    currentChatId = id;
    try {
      const resp = await fetch(`/get_chat_messages/${id}/`);
      const data = await resp.json();
      renderMessages(data.messages || []);
      hideSidebarOnMobile();
    } catch(err){
      console.error(err);
      showError("Failed to load chat history.");
    }
  }

  // ğŸ“¤ Send Message
async function sendMessage() {
    const inputEl = document.getElementById("user_input");
    const userMessage = inputEl.value.trim();
    if (!userMessage) return;

    renderMessages([{sender:"user", text:userMessage}], true);
    inputEl.value = "";
    document.getElementById("typing").classList.remove("hidden");
    hideError();

    const crisisKeywords = ["suicide", "marne", "marna", "hopeless", "die", "end life"];

    const isCrisis = crisisKeywords.some(word => userMessage.toLowerCase().includes(word));

    try {
        let replyText = "";

        if (isCrisis) {
            // Serious distress â†’ static consoling + professional numbers
            replyText = `ğŸ’š I hear you. It sounds like you are in serious distress. Please contact professional help immediately:\n` +
                        `ğŸ“ India: 9152987821 (Vandrevala Foundation)\n` +
                        `ğŸ“ Jeevan Aastha: 022-27546669\n` +
                        `ğŸ™ You can also talk to someone you trust. Iâ€™m here to listen too.`;
        } else {
            // âœ… Call your API for ALL messages including stress/exam/mental wellness
            const resp = await fetch("/chatbot_api/", {
                method: "POST",
                headers: { 
                    "X-CSRFToken": csrftoken,
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: new URLSearchParams({
                    message: userMessage,
                    mood: userMood,
                    session_id: currentChatId || ""
                })
            });

            if (!resp.ok) throw new Error("Network response was not ok");

            const data = await resp.json();
            currentChatId = data.session_id;
            replyText = data.reply;
        }

        document.getElementById("typing").classList.add("hidden");
        renderMessages([{sender:"bot", text:replyText}], true);
        lastBotReply = replyText;
        showSuggestions(userMessage);

    } catch (err) {
        console.error(err);
        document.getElementById("typing").classList.add("hidden");
        showError("Network error or offline. Please check your connection.");
        renderMessages([{
            sender: "bot",
            text: "ğŸŒ You seem offline. Donâ€™t worry, Iâ€™m still here ğŸ’š. Try some deep breathing or write your thoughts in a journal until we reconnect."
        }], true);
        showSuggestions(userMessage);
    }
}


  // ğŸ’¬ Render messages
  function renderMessages(messages, append=false){
    const chatBox = document.getElementById("chat_area");
    if (!append) chatBox.innerHTML = "";
    messages.forEach(msg => {
      const div = document.createElement("div");
      div.className = msg.sender === "user" ? "flex justify-end" : "flex justify-start";
      const bubble = document.createElement("div");
      bubble.className = msg.sender === "user" ? "user-bubble" : "bot-bubble";
      bubble.innerText = msg.text;
      div.appendChild(bubble);
      chatBox.appendChild(div);
    });
    chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: "smooth" });
  }

  function speakBotReply(){
    if (!lastBotReply) return;

    if (isSpeaking) {
      synth.cancel();
      isSpeaking = false;
      return;
    }

    if (synth.speaking) synth.cancel();
    const utterance = new SpeechSynthesisUtterance(lastBotReply);

    // âœ… Language detection
    if (/[\u0900-\u097F]/.test(lastBotReply)) {
        utterance.lang = "hi-IN";   // Hindi
    } else if (/[\u0A80-\u0AFF]/.test(lastBotReply)) {
        utterance.lang = "gu-IN";   // Gujarati
    } else {
        utterance.lang = "en-US";   // English (default)
    }

    if (voices.length > 0) {
      let selectedVoice = voices.find(v => v.lang === utterance.lang);
      utterance.voice = selectedVoice || voices[0];  // fallback safe
    }

    utterance.onstart = () => { isSpeaking = true; };
    utterance.onend = () => { isSpeaking = false; };
    synth.speak(utterance);
  }

  // âœ… Voice Input ğŸ¤
  function startVoice(){
    if (!('webkitSpeechRecognition' in window)) {
      showError("âŒ Voice recognition not supported in this browser.");
      return;
    }
    const recognition = new webkitSpeechRecognition();
    recognition.lang = "en-US"; 
    recognition.start();

    recognition.onresult = function(event){
      let transcript = event.results[0][0].transcript;

      const crisisKeywords = ["suicide", "marne", "marna", "hopeless", "die", "end life"];
      const isCrisis = crisisKeywords.some(word => transcript.toLowerCase().includes(word));

      if(isCrisis){
        renderMessages([{sender:"bot", text:"ğŸ’š I hear you. It sounds like you are in serious distress. Please contact professional help immediately:\nğŸ“ India: 9152987821\nğŸ“ Jeevan Aastha: 022-27546669"}], true);
        return;
      }

      document.getElementById("user_input").value = transcript;
      sendMessage();
    };

    recognition.onerror = function(event) {
      showError("Voice recognition error: " + event.error);
    };
  }

  // ğŸ—‘ Clear All
  function clearHistory(){
    if (!confirm("Are you sure you want to clear all chats?")) return;
    document.getElementById("chat_history").innerHTML = `<div class="text-gray-500 italic text-center">No chats yet...</div>`;
    document.getElementById("chat_area").innerHTML = `<div class="text-center text-gray-400 italic animate-fadeIn">ğŸ‘‹ Start a conversation...</div>`;
    currentChatId = null;
  }

  // Error Handling
  function showError(message) {
    const errorEl = document.getElementById("errorMessage");
    errorEl.querySelector("span").innerText = message;
    errorEl.classList.remove("hidden");
  }

  function hideError() {
    document.getElementById("errorMessage").classList.add("hidden");
  }

  // Sidebar Toggle for Mobile
  const sidebar = document.getElementById("sidebar");
  const toggleBtn = document.getElementById("sidebarToggle");
  toggleBtn.addEventListener("click", () => {
    sidebar.classList.toggle("-translate-x-full");
    sidebar.classList.toggle("xs:translate-x-0");
  });

  function hideSidebarOnMobile() {
    if (window.innerWidth < 768) {
      sidebar.classList.add("xs:translate-x-[-100%]");
      sidebar.classList.remove("xs:translate-x-0");
    }
  }

  // Quick buttons
  function sendQuick(msg){
    document.getElementById("user_input").value = msg;
    sendMessage();
  }

  // Enter key send
  document.getElementById("user_input").addEventListener("keypress", function (e) {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });
</script>

<!-- Styles -->
<style>
/* Enhanced Production-Level Styles */

/* ===== General ===== */
body {
  background: black;
  overscroll-behavior: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ===== Bot Bubble ===== */
.bot-bubble {
  background: linear-gradient(135deg, rgba(31,64,55,0.95), rgba(153,242,200,0.95));
  color: white;
  border-radius: 28px;
  padding: 16px 20px;
  max-width: 80%;
  box-shadow: 0 6px 16px rgba(0,0,0,0.4);
  word-wrap: break-word;
  font-size: 1rem;
  line-height: 1.5;
  transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  animation: fadeInUp 0.4s ease-out;
}
.bot-bubble:hover {
  transform: translateY(-3px);
}

/* ===== User Bubble ===== */
.user-bubble {
  background: linear-gradient(135deg, rgba(56,239,125,0.95), rgba(17,153,142,0.95));
  color: white;
  border-radius: 28px;
  padding: 16px 20px;
  max-width: 80%;
  box-shadow: 0 6px 16px rgba(0,0,0,0.4);
  word-wrap: break-word;
  font-size: 1rem;
  line-height: 1.5;
  transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  animation: fadeInUp 0.4s ease-out;
}
.user-bubble:hover {
  transform: translateY(-3px);
}

/* ===== Typing Indicator ===== */
.dot {
  animation-duration: 1.2s;
  animation-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

/* ===== Offline Banner ===== */
#offlineBanner {
  border-bottom-left-radius: 20px;
  border-bottom-right-radius: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  letter-spacing: 0.02em;
  animation: slideDown 0.6s ease-out forwards;
}

/* ===== Animations ===== */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes slideDown {
  from { transform: translateY(-100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
.animate-fadeIn {
  animation: fadeIn 0.5s ease-out;
}
.animate-slideDown {
  animation: slideDown 0.5s ease-out;
}

/* ===== Scrollbar ===== */
.scrollbar-thin::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}
.scrollbar-thin::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.15);
  border-radius: 3px;
}
.scrollbar-thin::-webkit-scrollbar-track {
  background: transparent;
}

/* ===== Responsive ===== */
@media (max-width: 768px) {
  .xs\:absolute { position: absolute; }
  .xs\:z-10 { z-index: 10; }
  .xs\:translate-x-\[-100\%\] { transform: translateX(-100%); }
  .xs\:transition-transform { transition: transform 0.3s ease-in-out; }
  #chat_area { padding: 4rem 1rem 1rem; }
  .p-6 { padding: 1.5rem; }
  .p-4 { padding: 1rem; }
  .p-8 { padding: 2rem 1rem; }
  .gap-4 { gap: 1rem; }
  .gap-3 { gap: 0.75rem; }
  .text-2xl { font-size: 1.5rem; }
  .text-lg { font-size: 1rem; }
  .text-base { font-size: 0.875rem; }
  .text-sm { font-size: 0.75rem; }
}

</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</html>